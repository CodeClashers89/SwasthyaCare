{% extends 'base.html' %}

{% block title %}My Appointments - SwasthyaCare{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">My Appointments</h1>
    <p class="page-subtitle">Manage your patient appointments</p>
</div>

<div class="card">
    <div class="card-header flex-between">
        <span>Filter Appointments</span>
        <div class="flex-gap">
            <a href="?status=all"
                class="btn btn-sm {% if status_filter == 'all' %}btn-primary{% else %}btn-secondary{% endif %}">All</a>
            <a href="?status=scheduled"
                class="btn btn-sm {% if status_filter == 'scheduled' %}btn-primary{% else %}btn-secondary{% endif %}">Scheduled</a>
            <a href="?status=completed"
                class="btn btn-sm {% if status_filter == 'completed' %}btn-success{% else %}btn-secondary{% endif %}">Completed</a>
            <a href="?status=no_show"
                class="btn btn-sm {% if status_filter == 'no_show' %}btn-warning{% else %}btn-secondary{% endif %}">No
                Show</a>
        </div>
    </div>
    <div class="card-body">
        {% if appointments %}
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Date & Time</th>
                        <th>Patient</th>
                        <th>Reason</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for appointment in appointments %}
                    <tr>
                        <td>
                            <strong>{{ appointment.appointment_date }}</strong><br>
                            {{ appointment.appointment_time|time:"h:i A" }}
                        </td>
                        <td>
                            <strong>{{ appointment.patient.patient_id }}</strong><br>
                            {{ appointment.patient.user.get_full_name }}<br>
                            <small style="color: var(--text-secondary);">{{ appointment.patient.user.phone }}</small>
                        </td>
                        <td>{{ appointment.reason|truncatewords:15 }}</td>
                        <td>
                            <span class="badge badge-{{ appointment.status|lower|cut:' '|cut:'_' }}">
                                {{ appointment.get_status_display }}
                            </span>
                            {% if appointment.is_follow_up %}
                            <span class="badge badge-doctor">Follow-up</span>
                            {% endif %}
                        </td>
                        <td class="actions">
                            <a href="{% url 'hospital:patient_history' appointment.patient.id %}"
                                class="btn btn-sm btn-primary">History</a>
                            {% if appointment.status == 'SCHEDULED' %}
                            <a href="{% url 'hospital:add_medical_record' appointment.id %}"
                                class="btn btn-sm btn-success">Add Record</a>
                            <form method="post" action="{% url 'hospital:update_appointment_status' appointment.id %}"
                                style="display: inline;">
                                {% csrf_token %}
                                <input type="hidden" name="status" value="COMPLETED">
                                <button type="submit" class="btn btn-sm btn-success">Complete</button>
                            </form>
                            <form method="post" action="{% url 'hospital:update_appointment_status' appointment.id %}"
                                style="display: inline;">
                                {% csrf_token %}
                                <input type="hidden" name="status" value="NO_SHOW">
                                <button type="submit" class="btn btn-sm btn-warning">No Show</button>
                            </form>
                            <a href="{% url 'hospital:create_follow_up' appointment.id %}"
                                class="btn btn-sm btn-secondary">Follow-up</a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">ðŸ“‹</div>
            <p class="empty-state-text">No appointments found</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}